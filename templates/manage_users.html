<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Управление пользователями</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>Управление пользователями</h1>

    <!-- Сообщения об ошибках -->
    {% if error %}
      <div class="error-message" style="color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
        {{ error }}
      </div>
    {% endif %}

    <!-- Форма добавления нового пользователя -->
    <div class="user-form-section">
      <h2>Добавить нового пользователя</h2>
      <form method="POST" action="{{ url_for('manage_users') }}" class="user-form">
        <div class="form-group">
          <label for="username">Имя пользователя:</label>
          <input type="text" id="username" name="username" required>
        </div>
        
        <div class="form-group">
          <label for="password">Пароль:</label>
          <input type="password" id="password" name="password" required>
        </div>
        
        <div class="form-group">
          <label for="role">Роль:</label>
          <select id="role" name="role" required>
            <option value="user">Пользователь</option>
            <option value="editor">Редактор</option>
            <option value="admin">Администратор</option>
          </select>
        </div>
        
        <button type="submit" name="action" value="add" class="btn-add-user">Добавить пользователя</button>
      </form>
    </div>

    <!-- Таблица пользователей -->
    <div class="users-table-section">
      <h2>Список пользователей</h2>
      
      {% if users %}
        <table class="users-table">
          <thead>
            <tr>
              <th>Имя пользователя</th>
              <th>Роль</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
              <tr>
                <td>{{ user.username }}</td>
                <td>
                  <form method="POST" action="{{ url_for('manage_users') }}" style="display:inline;">
                    <input type="hidden" name="username" value="{{ user.username }}">
                    <select name="role" onchange="this.form.submit()">
                      <option value="user" {% if user.role == 'user' %}selected{% endif %}>Пользователь</option>
                      <option value="editor" {% if user.role == 'editor' %}selected{% endif %}>Редактор</option>
                      <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Администратор</option>
                    </select>
                    <input type="hidden" name="action" value="update_role">
                    <button type="submit" class="role-change-btn" style="display:none;">Изменить</button>
                  </form>
                </td>
                <td>
                  <form method="POST" action="{{ url_for('manage_users') }}" style="display:inline;" onsubmit="return confirm('Вы уверены, что хотите удалить пользователя {{ user.username }}?');">
                    <input type="hidden" name="username" value="{{ user.username }}">
                    <input type="hidden" name="action" value="delete">
                    <button type="submit" class="btn-delete-user">Удалить</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="no-users">Нет зарегистрированных пользователей</p>
      {% endif %}
    </div>

    <div class="back-link">
      <a href="{{ url_for('index') }}" class="btn-back">← Вернуться на главную</a>
    </div>
  </div>
  
  <script>
    // Обработчик для изменения роли - автоматически отправляет форму при изменении
    document.querySelectorAll('.users-table select[name="role"]').forEach(select => {
      select.addEventListener('change', function() {
        this.closest('form').submit();
      });
    });
  </script>
</body>
</html>